import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import styled from 'styled-components';

import { theme, listReset } from '@devseed-ui/theme-provider';
import { Button } from '@devseed-ui/button';
import {
  CollecticonHeart,
  CollecticonSlidersHorizontal,
  CollecticonTrashBin,
} from '@devseed-ui/collecticons';
import { AccordionManager, useAccordion, AccordionFold } from '.';

export const CustomAccordionList = styled.ul`
  ${listReset()}
`;

export const CustomHeader = styled.header`
  display: flex;
  align-items: center;
  background: #cf3f02;
  color: #fff;
  padding: 0 2rem;
  h1 {
    font-size: 1rem;
  }
`;

export const CustomHeaderToolbar = styled.div`
  margin-left: auto;
`;

export const CustomAccordionFold = styled.article`
  border: 1px dashed #cf3f02;
  border-radius: 2rem;
`;

export const AccordionGlobalControls = function() {
  const { expandAll, collapseAll } = useAccordion();
  return (
    <div>
      <button onClick={expandAll}>Expand All</button>
      <button onClick={collapseAll}>Collapse All</button>
    </div>
  );
}

<Meta title="Components/Accordion" />

# Accordion

Simple accordion.

```
yarn add @devseed-ui/accordion
```

```js
import {
  useAccordion,
  useAccordionFold,
  AccordionManager,
  AccordionFold,
  AccordionFoldHeader,
  AccordionFoldTrigger,
  AccordionFoldBodyInner
} from '@devseed-ui/accordion'
```

export const renderFnParams = {
  summary: 'function(helpers)',
  detail: `helpers = {
  contentId: Id of the fold's content area
  isExpanded: Whether or not the fold is expanded;
  setExpandedState: Set the new state for this fold;
  toggleExpanded: Toggle current state;
}`
}

<Canvas>
  <Story
    name="Simple"
    argTypes={{
      allowMultiple: {
        name: 'allowMultiple',
        type: { name: 'boolean', required: false },
        defaultValue: false,
        description: 'Whether multiple folds can be open at the same time',
        table: {
          category: 'Accordion Manager',
          type: { summary: 'boolean' },
          defaultValue: { summary: false },
        },
        control: {
          type: 'boolean',
        },
      },
      id: {
        name: 'id',
        type: { name: 'text', required: true },
        defaultValue: 'interactive-accordion',
        description: 'An id for the fold',
        table: {
          category: 'Accordion Fold',
          type: { summary: 'string' },
          defaultValue: { summary: undefined },
        },
        control: {
          type: 'text',
        },
      },
      title: {
        name: 'title',
        type: { name: 'text', required: false },
        defaultValue: 'Interactive accordion',
        description: 'Title to use on the fold header. Required unless `renderHeader` is being used.',
        table: {
          category: 'Accordion Fold',
          type: { summary: 'string' },
          defaultValue: { summary: undefined },
        },
        control: {
          type: 'text',
        },
      },
      content: {
        name: 'content',
        type: { name: 'node', required: false },
        defaultValue: 'This is the accordion you can interact with through Storybook control.',
        description: 'Content for the fold. Required unless `renderBody` is being used.',
        table: {
          category: 'Accordion Fold',
          type: { summary: 'react node' },
          defaultValue: { summary: undefined },
        },
        control: {
          type: 'text',
        },
      },
      initialOpen: {
        name: 'initialOpen',
        type: { name: 'boolean', required: false },
        defaultValue: false,
        description: 'Whether to open the contents of the accordion on landing.',
        table: {
          category: 'Accordion Fold',
          type: { summary: 'boolean' },
          defaultValue: { summary: false },
        },
        control: {
          type: 'boolean',
        },
      },
      headingAs: {
        name: 'headingAs',
        defaultValue: 'h3',
        type: { name: 'text', required: false },
        description: 'Heading level for the title of the accordion. Required unless `renderHeader` is being used.',
        options: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],
        table: {
          category: 'Accordion Fold',
          type: { summary: 'string' },
          defaultValue: { summary: '' },
        },
        control: {
          type: 'select',
        },
      },
      renderHeader: {
        name: 'renderHeader',
        type: { name: 'function', required: false },
        description:
          'A function called to render and replace the accordion header. Must return a valid React node.',
        table: {
          category: 'Accordion Fold',
          type: renderFnParams
        },
        control: {
          type: null,
        },
      },
      renderBody: {
        name: 'renderBody',
        type: { name: 'function', required: false },
        description:
          'A function called to render the accordion body content. Must return a valid React node.',
        table: {
          category: 'Accordion Fold',
          type: renderFnParams
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {({ allowMultiple, ...args}) => (
    <AccordionManager allowMultiple={allowMultiple}>
      <AccordionFold
        headingAs="h3"
        id="towel"
        title="Towel"
        content={
          <p>
            A towel, [The Hitchhiker&apos;s Guide to the Galaxy] says, is about
            the most massively useful thing an interstellar hitchhiker can have.
            Partly it has great practical value. You can wrap it around you for
            warmth as you bound across the cold moons of Jaglan Beta; you can
            lie on it on the brilliant marble-sanded beaches of Santraginus V,
            inhaling the heady sea vapors; you can sleep under it beneath the
            stars which shine so redly on the desert world of Kakrafoon; use it
            to sail a miniraft down the slow heavy River Moth; wet it for use in
            hand-to-hand-combat; wrap it round your head to ward off noxious
            fumes or avoid the gaze of the Ravenous Bugblatter Beast of Traal
            (such a mind-boggingly stupid animal, it assumes that if you
            can&apos;t see it, it can&apos;t see you); you can wave your towel
            in emergencies as a distress signal, and of course dry yourself off
            with it if it still seems to be clean enough.
          </p>
        }
      />
      <AccordionFold
        {...args}
      />
    </AccordionManager>
    )}
  </Story>
</Canvas>

<ArgsTable story="Simple" />


## Accordion Manager

Accordion Manager must wrap the Accordion Folds and stores the data needed for the accordions to work. You can control whether to show multiple accordion contents through Accordion Manager.   
Since the Accordion component is only a state manager it is recommended that accordion folds are structured as list items for semantic value.

<Canvas>
  <Story
    name="Accordion Manager"
      argTypes={{
        allowMultiple: {
          name: 'allowMultiple',
          defaultValue: true,
          type: { name: 'boolean', required: false},
          description: 'Whether or not to allow multiple open folds at the same time..',
          table: {
            type: { summary: 'boolean' },
            defaultValue: { summary: false },
          },
          control: {
            type: 'boolean'
          }
        
      }
    }}
  >
    {args => (
    <AccordionManager {...args}>
      <CustomAccordionList>
        <li>
          <AccordionFold
            headingAs="h3"
            id="multiple"
            initialOpen
            title="Multiple folds"
            content={
              <p>
                This accordion not only allows for multiple folds to be open at
                the same time, but it also has an initial state where the first
                one is open.
              </p>
            }
          />
          </li>
          <li>
          <AccordionFold
            headingAs="h3"
            id="list"
            title="Folds as lists"
            content={
              <p>
                Although the Accordion component is only a state manager it is
                recommended that accordion folds are structured as list items
                for semantic value.
              </p>
            }
          />   
        </li>
      </CustomAccordionList>
    </AccordionManager>
    )}
  </Story>
</Canvas>

<ArgsTable story="Accordion Manager" />

## Custom render methods

Since the accordion component is a mere state manager it is possible to use it to manage very custom folds.  
Using render props, the content of the fold header and body can be overridden.  
The fold component below was re-styled and changed to an article. The new wrapper component is passed through style-component's <code>forwardAs</code> prop.

<Canvas>
  <Story
    name="Custom render methods"
  >
    <AccordionManager>
      <CustomAccordionList>
        <li>
          {/*
            Custom styled component to style accordion fold
            const CustomAccordionFold = styled.article`
              border: 1px dashed #cf3f02;
              border-radius: 2rem;
            `;
          */}
          <AccordionFold
            headingAs="h3"
            id="custom"
            title="Custom Folds"
            forwardedAs={CustomAccordionFold}
            content={
              <p>
                Since the accordion component is a mere state manager it is
                possible to use it to manage very custom folds.
              </p>
            }
          />
        </li>
        <li>
          <AccordionFold
            id="header"
            renderHeader={({ isExpanded, toggleExpanded, contentId }) => (
              <CustomHeader>
                <h1>Custom Fold Header</h1>
                <CustomHeaderToolbar>
                  <Button fitting="skinny" disabled variation="achromic-text">
                    <CollecticonTrashBin title="Delete" meaningful />
                  </Button>
                  <Button fitting="skinny" disabled variation="achromic-text">
                    <CollecticonHeart title="Like" meaningful />
                  </Button>
                  <Button
                    fitting="skinny"
                    variation="achromic-text"
                    active={isExpanded}
                    onClick={() => toggleExpanded()}
                    aria-controls={contentId}
                    aria-expanded={isExpanded}
                  >
                    <CollecticonSlidersHorizontal title="Settings" meaningful />
                  </Button>
                </CustomHeaderToolbar>
              </CustomHeader>
            )}
            content={<p>Content for our custom fold.</p>}
          />
        </li>
      </CustomAccordionList>
    </AccordionManager>
  </Story>
</Canvas>

## Accordion hooks

The Accordion module provides hooks to allow more fine grained control over the accordion behavior.

```js
const {
  expandAll,
  collapseAll,
  setExpandedState,
  toggleExpanded
} = useAccordion();
```

<Canvas>
  <Story
    name="Accordion global controls"
  >
    <AccordionManager>
      {/* custom component to fold/unfold all:
        function AccordionGlobalControls() {
          const { expandAll, collapseAll } = useAccordion();
          return (
            <div>
              <button onClick={expandAll}>Expand All</button>
              <button onClick={collapseAll}>Collapse All</button>
            </div>
          );
      } */}
      <AccordionGlobalControls/>
      <CustomAccordionList>
        <li>
          <AccordionFold
            headingAs="h3"
            id="general"
            title="General controls"
            content={
              <p>
                The Accordion component provides functions that allow to
                collapse/expand all components at once.
              </p>
            }
          />
        </li>
        <li>
          <AccordionFold
            headingAs="h3"
            id="lists"
            title="Folds as lists"
            content={
              <p>
                Although the Accordion component is only a state manager it is
                recommended that accordion folds are structured as list items
                for semantic value.
              </p>
            }
          />
        </li>
      </CustomAccordionList>
    </AccordionManager>
  </Story>
</Canvas>
