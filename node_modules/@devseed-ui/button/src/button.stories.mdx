import { useState } from 'react';
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import styled from 'styled-components';

import {
  theme,
  listReset,
  glsp,
  themeVal,
  truncated,
} from '@devseed-ui/theme-provider';
import { CollecticonHeart, CollecticonPlus } from '@devseed-ui/collecticons';
import { backgroundOption } from '../../../.storybook/story-utils';

import { Button, ButtonGroup } from '.';

export const buttonBaseProps = {
  size: {
    name: 'size',
    type: { name: 'string', required: false },
    defaultValue: 'medium',
    description: 'Sets the Button size',
    table: {
      type: { summary: 'string' },
      defaultValue: { summary: 'medium' },
    },
    control: {
      type: 'select',
    },
    options: ['small', 'medium', 'large', 'xlarge'],
  },
  radius: {
    name: 'radius',
    type: { name: 'string', required: false },
    defaultValue: 'rounded',
    description: 'Control the button radius making it more or less rounded.',
    table: {
      type: { summary: 'string' },
      defaultValue: { summary: 'rounded' },
    },
    control: {
      type: 'select',
    },
    options: ['ellipsoid', 'square', 'rounded'],
  },
};

<Meta title="Components/Button" />

## Button

The `achromic` variations of buttons should be viewed over a dark background.

```
yarn add @devseed-ui/button
```

```js
import {
  useButtonGroup,
  createButtonStyles,
  createButtonGroupStyles,
  Button,
  ButtonGroup,
  ButtonGroupProvider,
} from '@devseed-ui/button'
```

<Canvas>
  <Story
    name="Simple"
    argTypes={{
      variation: {
        name: 'variation',
        type: { name: 'string', required: false },
        defaultValue: 'primary-fill',
        description:
          'Sets the Button variation. A regular variation is a combination of `color-name`-`text|fill|outline`. Achromic versions are only outline or text.',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'base-text' },
        },
        control: {
          type: 'select',
        },
        options: [
          'base-text',
          'base-fill',
          'base-outline',
          'primary-text',
          'primary-fill',
          'primary-outline',
          'danger-text',
          'danger-fill',
          'danger-outline',
          'success-text',
          'success-fill',
          'success-outline',
          'warning-text',
          'warning-fill',
          'warning-outline',
          'info-text',
          'info-fill',
          'info-outline',
          'achromic-text',
          'achromic-outline',
        ],
      },
      ...buttonBaseProps,
      fitting: {
        name: 'fitting',
        type: { name: 'string', required: false },
        defaultValue: 'regular',
        description:
          'The `fitting` controls how the button fits in its container and its padding. When using a button with an icon only it is important to set the fitting to `skinny`',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'regular' },
        },
        control: {
          type: 'select',
        },
        options: ['skinny', 'regular', 'relaxed', 'baggy'],
      },
      disabled: {
        name: 'disabled',
        type: { name: 'boolean', required: false },
        defaultValue: false,
        description: 'Whether the Button is in disabled state.',
        table: {
          type: { summary: 'boolean' },
          defaultValue: { summary: false },
        },
        control: {
          type: 'boolean',
        },
      },
      active: {
        name: 'active',
        type: { name: 'boolean', required: false },
        defaultValue: false,
        description: 'Whether the Button is in active state',
        table: {
          type: { summary: 'boolean' },
          defaultValue: { summary: false },
        },
        control: {
          type: 'boolean',
        },
      },
    }}
  >
    {args => <Button {...args}>Button</Button>}
  </Story>
</Canvas>

<ArgsTable story="Simple" />

export const IconButtonsWrapper = styled.div`
  display: flex;
  gap: 1rem;
`;

export const ThirdPartyBtn = styled.div`
  .third-party {
    ${props => createButtonStyles(props)}
  }
`;

export const TextWrapper = styled.span`
  ${truncated}
  max-width: 10rem;
`;

### Buttons with Icons (Collecticons)

Buttons pair very well with Collecticons, and they can be used as the button's content.
If you're using a Button with **only** an Icon as content, be sure to set the Button's `fitting` to `skinny` and add a `meaningful` title to the Collection. See Collecticons' docs for more.

<Canvas>
  <Story name="Icon buttons">
    {() => (
      <IconButtonsWrapper>
        <Button variation="primary-outline" fitting="skinny">
          <CollecticonHeart title="It is a plus sign" meaningful />
        </Button>
        <Button variation="primary-fill">
          <CollecticonHeart /> Create new
        </Button>
        <Button variation="base-fill">
          <CollecticonHeart />{' '}
          <TextWrapper>Lorem ipsum dolor sit amet</TextWrapper>
        </Button>
        <Button variation="primary-fill" forwardedAs="a">
          <CollecticonHeart /> &lt;a&gt; button
        </Button>
      </IconButtonsWrapper>
    )}
  </Story>
</Canvas>

## Styling third-party buttons

In some cases it is necessary to style buttons from third party libraries where it is not possible to replace the element with a Styled Component.

Using the `createButtonStyles(props)` function, which accepts the same props as a `Button`, the same styles can be applied to a css class.

```jsx
const Wrapper = styled.div`
  .third-party-button {
    ${createButtonStyles({ variation: 'primary-outline' })}
  }
`;

<Wrapper>
  <button
    title="A third party button"
    className="third-party-button"
    onClick={() => {}}
  >
    Third party
  </button>
</Wrapper>;
```

## Button Groups

Used to group buttons that are related while giving the group semantic meaning.  
Buttons in a group will be joined and look like a single unit.

Because the buttons are visually together, their `variation`, `size` and `radius` should be the same. It is also important that the variation is not `*-text`.

For this reason and to reduce errors, these properties can be set on the `ButtonGroup` and the `Button` will react to them.

```jsx
<ButtonGroup variation="primary-fill" size="xlarge" radius="ellipsoid">
  <Button>One</Button>
  <Button>Two</Button>
  <Button>Three</Button>
</ButtonGroup>
```

> If you're building your own custom buttons and what them to react to the props passed to a `ButtonGroup` you can use the `useButtonGroup` hook.

<Canvas>
  <Story
    name="Button groups"
    argTypes={{
      orientation: {
        name: 'orientation',
        type: { name: 'string', required: false },
        defaultValue: 'horizontal',
        description:
          'Control whether the group is displayed horizontally or vertically.',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'horizontal' },
        },
        control: {
          type: 'select',
        },
        options: ['horizontal', 'vertical'],
      },
      variation: {
        name: 'variation',
        type: { name: 'string', required: false },
        defaultValue: 'primary-fill',
        description:
          'Sets the Button variation. A regular variation is a combination of `color-name`-`fill|outline`. Achromic versions are only outline.',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'base-fill' },
        },
        control: {
          type: 'select',
        },
        options: [
          'base-fill',
          'base-outline',
          'primary-fill',
          'primary-outline',
          'danger-fill',
          'danger-outline',
          'success-fill',
          'success-outline',
          'warning-fill',
          'warning-outline',
          'info-fill',
          'info-outline',
          'achromic-outline',
        ],
      },
      ...buttonBaseProps,
    }}
  >
    {args => {
      const [activeBtn, setActiveBtn] = useState('one');
      return (
        <ButtonGroup {...args}>
          <Button
            active={activeBtn === 'one'}
            onClick={() => setActiveBtn('one')}
          >
            <CollecticonHeart /> One
          </Button>
          <Button
            active={activeBtn === 'two'}
            onClick={() => setActiveBtn('two')}
          >
            Two
          </Button>
          <Button
            fitting="skinny"
            active={activeBtn === 'three'}
            onClick={() => setActiveBtn('three')}
          >
            <CollecticonPlus title="It is a plus sign" meaningful />
          </Button>
        </ButtonGroup>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Button groups" />

## Showcase

export const buttonTypes = ['text', 'fill', 'outline'];
export const buttonColors = ['base', 'primary', 'danger', 'success'];
export const buttonSizes = ['small', 'medium', 'large', 'xlarge'];
export const buttonRadius = ['rounded', 'ellipsoid', 'square'];
export const buttonFitting = ['skinny', 'regular', 'relaxed', 'baggy'];

export const ButtonVariationsWrapper = styled.div`
  display: grid;
  grid-gap: 2rem;
  padding: 1rem;
`;

export const Showcase = styled.div``;

export const ShowcaseVariations = styled.div`
  padding: 1rem;
  grid-template-columns: repeat(4, 1fr);
  display: grid;
  grid-gap: 1rem;
  justify-items: center;
  align-items: center;
  ${backgroundOption}
`;

<Canvas>
  <Story name="Showcase">
    {() => (
      <ButtonVariationsWrapper>
        <Showcase>
          <h2>Variations</h2>
          <p>
            list of button <code>variations</code>.
          </p>
          <ShowcaseVariations>
            {buttonTypes.map(type =>
              buttonColors.map(color => (
                <Button key={`${color}-${type}`} variation={`${color}-${type}`}>
                  {color}-{type}
                </Button>
              )),
            )}
          </ShowcaseVariations>
        </Showcase>
        <Showcase>
          <h2>Size</h2>
          <p>
            list of button <code>sizes</code> with primary color.
          </p>
          <ShowcaseVariations>
            {buttonTypes.map(type =>
              buttonSizes.map(size => (
                <Button
                  key={`${size}-${type}`}
                  variation={`primary-${type}`}
                  size={size}
                >
                  primary-{type} {size}
                </Button>
              )),
            )}
          </ShowcaseVariations>
        </Showcase>
        <Showcase>
          <h2>Radius</h2>
          <p>
            list of button <code>radius</code> and <code>size</code> with
            primary-fill variation.
          </p>
          <ShowcaseVariations>
            {buttonRadius.map(radius =>
              buttonSizes.map(size => (
                <Button
                  key={`${radius}-${size}`}
                  variation={`primary-fill`}
                  radius={radius}
                  size={size}
                >
                  {radius} {size}
                </Button>
              )),
            )}
          </ShowcaseVariations>
        </Showcase>
        <Showcase>
          <h2>Fitting</h2>
          <p>
            list of button <code>fitting</code> with primary-fill variation.
          </p>
          <ShowcaseVariations>
            {buttonFitting.map(fitting => (
              <Button
                key={fitting}
                variation={`primary-fill`}
                fitting={fitting}
              >
                {fitting}
              </Button>
            ))}
          </ShowcaseVariations>
        </Showcase>
        <Showcase>
          <h2>Achromic</h2>
          <p>Achromic special variations</p>
          <ShowcaseVariations bg="dark">
            <Button variation="achromic-text">achromic-text</Button>
            <Button variation="achromic-outline">achromic-outline</Button>
          </ShowcaseVariations>
        </Showcase>
      </ButtonVariationsWrapper>
    )}
  </Story>
</Canvas>
