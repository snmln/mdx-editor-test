import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import styled from 'styled-components';
import { Button } from '@devseed-ui/button';
import {
  CollecticonTrashBin,
  CollecticonUpload2,
} from '@devseed-ui/collecticons';

import {
  Dropdown,
  DropInset,
  DropTitle,
  DropMenu,
  DropMenuItem,
  getTetherAttachments,
} from '.';

<Meta title="Components/Dropdown" />

## Dropdown

Create a dropdown using a tethered element, to ensure that it is always displayed correctly.
If there's not enough space it will automatically change the opening direction.

```
yarn add @devseed-ui/dropdown
```

```js
import {
  Dropdown,
  DropTitle,
  DropMenu,
  DropMenuItem,
  DropInset
} from '@devseed-ui/dropdown'
```

### Structure

Besides the `Dropdown` component, the module also makes available a series of styles components to be used inside the dropdown.

- DropTitle - `Overline` from `@devseed-ui/typography`
- DropMenu - `ul`
- DropMenuItem - `a`
- DropInset - `div`

<Canvas>
  <Story
    name="Simple"
    argTypes={{
      id: {
        name: 'id',
        type: { name: 'string', required: true },
        description: 'Sets the dropdown ID',
        table: {
          type: { summary: 'string' },
        },
        control: {
          type: null,
        },
      },
      direction: {
        name: 'direction',
        type: { name: 'string', required: false },
        description: `Sets opening direction of the dropdown.`,
        defaultValue: 'down',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'down' },
        },
        control: {
          type: 'select',
        },
        options: ['up', 'down', 'left', 'right'],
      },
      alignment: {
        name: 'alignment',
        type: { name: 'string', required: false },
        description:
          'Sets the alignment of the dropdown. `left`, `center`, `right` can only be used with `up`, `down` directions. `top`, `middle`, `bottom` can only be used with `left`, `right` directions.',
        defaultValue: 'center',
        table: {
          type: { summary: 'string' },
          defaultValue: { summary: 'center' },
        },
        control: {
          type: 'select',
        },
        options: ['left', 'center', 'right', 'top', 'middle', 'bottom'],
      },
      classname: {
        name: 'classname',
        type: { name: 'string', required: false },
        description: 'Additional classnames for the dropdown content box',
        table: {
          type: { summary: 'string' },
        },
        control: {
          type: 'text',
        },
      },
      renderTriggerElement: {
        name: 'renderTriggerElement',
        type: { name: 'function', required: false },
        description:
          'A function that returns a trigger element. The function is called with (props, label). The `props` must be spread onto the returning element.',
        table: {
          type: { summary: 'function' },
          defaultValue: {
            summary: '(props) => <Button {...props}>{label}</Button>',
          },
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {args => {
      try {
        getTetherAttachments(args.direction, args.alignment);
        return (
          <Dropdown
            alignment={args.alignment}
            direction={args.direction}
            triggerElement={props => (
              <Button variation="base-outline" title="Open dropdown" {...props}>
                Dropdown
              </Button>
            )}
          >
            <DropTitle>Drop Title</DropTitle>
            <DropMenu>
              <li>
                <DropMenuItem href='#'>Menu item 1</DropMenuItem>
              </li>
              <li>
                <DropMenuItem href='#'>Menu item 2</DropMenuItem>
              </li>
            </DropMenu>
            <DropMenu>
              <li>
                <DropMenuItem href='#'>
                  <CollecticonUpload2 /> Upload...
                </DropMenuItem>
              </li>
              <li>
                <DropMenuItem href='#'>
                  <CollecticonTrashBin /> Delete
                </DropMenuItem>
              </li>
            </DropMenu>
            <DropMenu>
              <li>
                <DropMenuItem href='#' active>Menu item 1</DropMenuItem>
              </li>
              <li>
                <DropMenuItem href='#'>Menu item 2</DropMenuItem>
              </li>
            </DropMenu>
            <DropInset>
              <p>Inset Text</p>
            </DropInset>
          </Dropdown>
        );
      } catch (e) {
        return <p>{e.message}</p>;
      }
    }}
  </Story>
</Canvas>

<ArgsTable story="Simple" />

### Closing on click

Clicking in the body of a dropdown won&apos;t do anything. However if an element has a `data-dropdown='click.close'` attribute, the dropdown will close.

This is a very useful attribute to add to `DropMenuItem` when the action does not result in a page navigation.

export const DropdownWide = styled(Dropdown)`
  max-width: 25rem;
`;

export const DropBodySmall = styled.div`
  font-size: 0.875rem;
  code {
    white-space: nowrap;
  }
`;

export const DropAttrAction = styled.p`
  margin: 0.5rem 0;
  padding: 0.25rem;
  border: 1px dashed #ddd;
`;

<Canvas>
  <Story name="Close on Click">
    {args => (
      <DropdownWide
        alignment="middle"
        direction="right"
        triggerElement={props => (
          <Button variation="primary-fill" title="Open dropdown" {...props}>
            Dropdown
          </Button>
        )}
      >
        <DropTitle>Drop with actions</DropTitle>
        <DropBodySmall>
          <p>
            Clicking in the body of a dropdown won&apos;t do anything. However
            if an element has a{' '}
            <code>data-dropdown=&apos;click.close&apos;</code> attribute, the
            dropdown will close
          </p>
          <DropAttrAction data-dropdown="click.close">
            <span>close me!</span>
          </DropAttrAction>
          <DropAttrAction>
            <span>clicking me has no effect.</span>
          </DropAttrAction>
        </DropBodySmall>
      </DropdownWide>
    )}
  </Story>
</Canvas>

### DropMenuItem

The DropMenuItem is to be used inside the `DropMenu`.

```jsx
<DropMenu>
  <li>
    <DropMenuItem href='#'>Menu item 1</DropMenuItem>
  </li>
  <li>
    <DropMenuItem href='#'>Menu item 2</DropMenuItem>
  </li>
</DropMenu>
```

<Canvas>
  <Story
    name="DropMenuItem"
    argTypes={{
      active: {
        name: 'active',
        type: { name: 'string' },
        description: 'Sets DropMenuItem as active',
        defaultValue: false,
        table: {
          type: { summary: 'boolean' },
        },
        control: {
          type: 'boolean',
        },
      },
      disabled: {
        name: 'disabled',
        type: { name: 'string' },
        description: 'Sets DropMenuItem as disabled',
        defaultValue: false,
        table: {
          type: { summary: 'boolean' },
        },
        control: {
          type: 'boolean',
        },
      },
    }}
  >
    {args => (
      <DropMenu>
        <li>
          <DropMenuItem href='#' {...args}>Menu item 1</DropMenuItem>
        </li>
      </DropMenu>
    )}
  </Story>
</Canvas>

<ArgsTable story="DropMenuItem" />
