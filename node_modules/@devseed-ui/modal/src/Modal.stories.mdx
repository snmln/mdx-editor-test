import { useState } from 'react';
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import { Button } from '@devseed-ui/button';
import {
  CollecticonCircleXmark,
  CollecticonCircleInformation,
} from '@devseed-ui/collecticons';
import { Heading, Overline } from '@devseed-ui/typography';

import { Modal, ModalHeader, ModalHeadline, ModalBody, ModalFooter } from './';

<Meta title="Components/Modal" />

# Modal

Displays a modal component which is portaled to the body to ensure is appears over all other elements.

```
yarn add @devseed-ui/modal
```

```js
import {
  Modal,
  ModalHeader,
  ModalHeadline,
  ModalToolbar,
  ModalBody,
  ModalFooter,
} from '@devseed-ui/modal';
```

<Canvas>
  <Story
    name="Basic Modal"
    argTypes={{
      id: {
        name: 'id',
        type: { name: 'string', required: true },
        description: 'Sets the modal ID',
        table: {
          category: 'Modal',
          type: { summary: 'string' },
        },
        control: {
          type: 'text',
        },
        defaultValue: 'modal',
      },
      size: {
        name: 'size',
        type: { name: 'string', required: false },
        description: 'Specifies the size of the modal',
        table: {
          category: 'Modal',
          type: { summary: 'string' },
          defaultValue: { summary: 'medium' },
        },
        control: {
          type: 'select',
        },
        options: ['small', 'medium', 'large', 'xlarge', 'fullscreen'],
      },
      revealed: {
        name: 'revealed',
        type: { name: 'boolean', required: false },
        description: 'Shows the model if `true`, hides if `false`.',
        table: {
          category: 'Modal',
          type: { summary: 'boolean' },
        },
        control: {
          type: null,
        },
      },
      disableKeyboardClose: {
        name: 'disableKeyboardClose',
        type: { name: 'boolean', required: false },
        description: 'Disables the use of ESC key to close the modal',
        table: {
          category: 'Modal',
          type: { summary: 'boolean' },
          defaultValue: { summary: false },
        },
        control: {
          type: 'boolean',
        },
      },
      onCloseClick: {
        name: 'onCloseClick',
        type: { name: 'function', required: false },
        description:
          "A function that is called when the user clicks the modal's close button",
        table: {
          category: 'Modal',
          type: { summary: 'function' },
        },
      },
      onOverlayClick: {
        name: 'onOverlayClick',
        type: { name: 'function', required: false },
        description:
          'A function that is called when the user clicks the overlay.',
        table: {
          category: 'Modal',
          type: { summary: 'function' },
        },
      },
      closeButton: {
        name: 'closeButton',
        type: { name: 'boolean', required: false },
        description: 'Shows the close buttons if `true`.',
        table: {
          category: 'Modal',
          type: { summary: 'boolean' },
          defaultValue: { summary: true },
        },
        control: {
          type: 'boolean',
        },
      },
      title: {
        name: 'title',
        type: { name: 'string', required: false },
        description: "Sets the modal's title, displayed in the modal's header.",
        table: {
          category: 'Modal',
          type: { summary: 'string' },
        },
        control: {
          type: 'text',
        },
        defaultValue: 'Modal title',
      },
      content: {
        name: 'content',
        type: { name: 'string', required: false },
        description: "Sets the modal's content.",
        table: {
          category: 'Modal',
          type: { summary: 'react node' },
        },
        control: {
          type: 'text',
        },
        defaultValue:
          'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla commodo, leo quis posuere faucibus, tortor tellus malesuada quam, sit amet.',
      },
      footerContent: {
        name: 'footerContent',
        type: { name: 'string', required: false },
        description: "Sets the modal footer's content.",
        table: {
          category: 'Modal',
          type: { summary: 'react node' },
        },
        control: {
          type: 'text',
        },
        defaultValue: 'Modal footer',
      },
    }}
  >
    {args => {
      const [isRevealed, setRevealed] = useState(false);
      const close = () => setRevealed(false);
      const reveal = () => setRevealed(true);
      return (
        <>
          <Button type="button" variation="primary-fill" onClick={reveal}>
            Show modal
          </Button>
          <Modal
            id={args.id}
            revealed={isRevealed}
            size={args.size}
            onCloseClick={close}
            onOverlayClick={close}
            closeButton={args.closeButton}
            disableKeyboardClose={args.disableKeyboardClose}
            title={args.title}
            content={args.content}
            footerContent={args.footerContent}
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Basic Modal" />

## Render modal components using functions

For more flexibilty you can further customize the modal header, body, and footer using function props.
The base structure of a modal is given by the following elements which can be replaced usring the appropriate render function.

```
<ModalContents>
                                -------------------------------------------|
  <ModalHeader>                      ---------------------|                |
                                                          |                |
    <ModalHeadline>                  ---|                 |                |
      <h1>title</h1>                    | renderHeadline  |                |
    </ModalHeadline>                 ---|                 |                |
                                                          | renderHeader   |
    <ModalToolbar>                   ---|                 |                |
      <button>Close Button</button>     | renderToolbar   |                |  renderContents
    </ModalToolbar>                  ---|                 |                |
                                                          |                |
  </ModalHeader>                     ---------------------|                |
                                                                           |
  <ModalBody>content</ModalBody>     ---------------------| renderBody     |
                                                                           |
  <ModalFooter>content</ModalFooter> ---------------------| renderFooter   |
                                -------------------------------------------|
</ModalContents>
```

Note: unlike the other render funtions `renderContents` only replaces the content of `ModalContents` and not the element itself.


export const renderFnType = {
  summary: 'function(helpers)',
  detail: `helpers = {
  close: function to close the modal
}`
};

<Canvas>
  <Story
    name="Content functions"
    argTypes={{
      renderHeader: {
        name: 'renderHeader',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal header. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
      renderBody: {
        name: 'renderBody',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal body. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
      renderFooter: {
        name: 'renderFooter',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal header. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {() => {
      const [isRevealed, setRevealed] = useState(false);
      const close = () => setRevealed(false);
      const reveal = () => setRevealed(true);
      const renderHeader = () => (
        <ModalHeader>
          <ModalHeadline>
            <Heading size="small">Modal Title</Heading>
          </ModalHeadline>
        </ModalHeader>
      );
      const renderBody = () => (
        <ModalBody>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus
            interdum, tellus non placerat lacinia, est metus gravida eros, sed
            imperdiet.
          </p>
        </ModalBody>
      );
      const renderFooter = () => (
        <ModalFooter>
          <Button type="button" onClick={close}>
            Close modal
          </Button>
        </ModalFooter>
      );
      return (
        <>
          <Button type="button" variation="primary-fill" onClick={reveal}>
            Show modal
          </Button>
          <Modal
            id="modal"
            revealed={isRevealed}
            onCloseClick={close}
            onOverlayClick={close}
            closeButton
            renderHeader={renderHeader}
            renderBody={renderBody}
            renderFooter={renderFooter}
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Content functions" />

`renderContents` allows to fully overwrite the modal contents, including header, footer and close button. You can structure the modal any way you like.

<Canvas>
  <Story
    name="Overwrite content"
    argTypes={{
      renderHeader: {
        name: 'renderContents',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal content. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {() => {
      const [isRevealed, setRevealed] = useState(false);
      const close = () => setRevealed(false);
      const reveal = () => setRevealed(true);
      const renderContents = () => (
        <>
          <ModalHeader>
            <ModalHeadline>
              <Heading size="small">Modal Title</Heading>
            </ModalHeadline>
          </ModalHeader>
          <ModalBody>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus
              interdum, tellus non placerat lacinia, est metus gravida eros, sed
              imperdiet.
            </p>
          </ModalBody>
          <ModalFooter>
            <Button type="button" onClick={close}>
              Close modal
            </Button>
          </ModalFooter>
        </>
      );
      return (
        <>
          <Button type="button" variation="primary-fill" onClick={reveal}>
            Show modal
          </Button>
          <Modal
            id="modal"
            revealed={isRevealed}
            onCloseClick={close}
            onOverlayClick={close}
            renderContents={renderContents}
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Overwrite content" />

To customize how the headline is rendered without overwriting the modals header, use `renderHeadline`.

<Canvas>
  <Story
    name="Overwrite headline"
    argTypes={{
      renderHeadline: {
        name: 'renderHeadline',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal headline. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {() => {
      const [isRevealed, setRevealed] = useState(false);
      const close = () => setRevealed(false);
      const reveal = () => setRevealed(true);
      const renderHeadline = () => (
        <ModalHeadline>
          <Overline>Title Overline</Overline>
          <Heading size="small">Modal Title</Heading>
        </ModalHeadline>
      );
      return (
        <>
          <Button type="button" variation="primary-fill" onClick={reveal}>
            Show modal
          </Button>
          <Modal
            id="modal"
            revealed={isRevealed}
            onCloseClick={close}
            onOverlayClick={close}
            closeButton
            renderHeadline={renderHeadline}
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Overwrite headline" />

To customise the close button or add additional buttons to the toolbar, use `renderToolbar`.

<Canvas>
  <Story
    name="Overwrite toolbar"
    argTypes={{
      renderToolbar: {
        name: 'renderToolbar',
        type: { name: 'function', required: false },
        description:
          'A function called to render the modal toolbar. Must return a valid React node.',
        table: {
          category: 'Modal',
          type: renderFnType,
        },
        control: {
          type: null,
        },
      },
    }}
  >
    {() => {
      const [isRevealed, setRevealed] = useState(false);
      const close = () => setRevealed(false);
      const reveal = () => setRevealed(true);
      const renderToolbar = () => (
        <ModalToolbar>
          <Button size="small" fitting="skinny" onClick={close}>
            <CollecticonCircleXmark title="Close modal" meaningful />
          </Button>
          <Button size="small" fitting="skinny" onClick={close}>
            <CollecticonCircleInformation title="Info" meaningful />
          </Button>
        </ModalToolbar>
      );
      return (
        <>
          <Button type="button" variation="primary-fill" onClick={reveal}>
            Show modal
          </Button>
          <Modal
            id="modal"
            revealed={isRevealed}
            onCloseClick={close}
            onOverlayClick={close}
            closeButton
            renderToolbar={renderToolbar}
            title="Modal Title"
          />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="Overwrite toolbar" />
